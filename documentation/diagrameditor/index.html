<!doctype html><html lang=en-us><head><meta name=theme content="Syna"><meta name=theme-version content="v0.17.2"><meta name=theme-url content="https://syna.okkur.org"><meta name=theme-description content="Highly customizable open source theme for Hugo based static websites"><meta name=theme-author content="Okkur Labs"><meta name=theme-author-url content="https://about.okkur.org"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google content="notranslate"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=description content="Introduction The foundation of implementing diagram editors is the GLSP framework. This guide will give an introduction to connect GLSP diagram editors with the ModelHub. Specifically, the GLSP diagram editor makes use of the ModelHub and the interfaces of the ModelService like the CoffeeModelServer or the CoffeeModelService for seamless integration and outsourced data management. Furthermore, specific examples of the Coffee Editor NG implementation will be given as a guideline."><meta property="og:title" content="Diagram Editors"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://www.eclipse.dev/emfcloud/documentation/diagrameditor/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Diagram Editors &amp;middot; EMF Cloud"><meta name=twitter:description content="Introduction The foundation of implementing diagram editors is the GLSP framework. This guide will give an introduction to connect GLSP diagram editors with the ModelHub. Specifically, the GLSP diagram editor makes use of the ModelHub and the interfaces of the ModelService like the CoffeeModelServer or the CoffeeModelService for seamless integration and outsourced data management. Furthermore, specific examples of the Coffee Editor NG implementation will be given as a guideline."><meta name=twitter:url content="https://www.eclipse.dev/emfcloud/documentation/diagrameditor/"><meta property="og:image" content><meta name=twitter:image content><meta name=author content="Eclipse Foundation"><meta name=generator content="Hugo 0.78.1"><title>Diagram Editors &#183; EMF Cloud</title><style>.mx-0{margin-left:0!important;margin-right:0!important}@-ms-viewport{width: device-width; }html{box-sizing:border-box;-ms-overflow-style:scrollbar}*,*::before,*::after{box-sizing:inherit}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;max-width:540px;max-width:720px;max-width:960px;max-width:1140px}.container-fluid{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}.row{display:flex;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.no-gutters{margin-right:0;margin-left:0}.no-gutters>.col,.no-gutters>[class*=col-]{padding-right:0;padding-left:0}.col-1,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-10,.col-11,.col-12,.col,.col-auto{position:relative;width:100%;min-height:1px;padding-right:15px;padding-left:15px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-auto{flex:0 0 auto;width:auto;max-width:none}.col-1{flex:0 0 8.33333%;max-width:8.33333%}.col-2{flex:0 0 16.66667%;max-width:16.66667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.33333%;max-width:33.33333%}.col-5{flex:0 0 41.66667%;max-width:41.66667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.33333%;max-width:58.33333%}.col-8{flex:0 0 66.66667%;max-width:66.66667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.33333%;max-width:83.33333%}.col-11{flex:0 0 91.66667%;max-width:91.66667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-last{order:13}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}.offset-1{margin-left:8.33333%}.offset-2{margin-left:16.66667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.33333%}.offset-5{margin-left:41.66667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.33333%}.offset-8{margin-left:66.66667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.33333%}.offset-11{margin-left:91.66667%}.d-none{display:none!important}.d-inline{display:inline!important}.d-inline-block{display:inline-block!important}.d-block{display:block!important}.d-table{display:table!important}.d-table-row{display:table-row!important}.d-table-cell{display:table-cell!important}.d-flex{display:flex!important}.d-inline-flex{display:inline-flex!important}@media print{.d-print-none{display:none!important}.d-print-inline{display:inline!important}.d-print-inline-block{display:inline-block!important}.d-print-block{display:block!important}.d-print-table{display:table!important}.d-print-table-row{display:table-row!important}.d-print-table-cell{display:table-cell!important}.d-print-flex{display:flex!important}.d-print-inline-flex{display:inline-flex!important}}.flex-row{flex-direction:row!important}.flex-column{flex-direction:column!important}.flex-row-reverse{flex-direction:row-reverse!important}.flex-column-reverse{flex-direction:column-reverse!important}.flex-wrap{flex-wrap:wrap!important}.flex-nowrap{flex-wrap:nowrap!important}.flex-wrap-reverse{flex-wrap:wrap-reverse!important}.flex-fill{flex:1 1 auto!important}.flex-grow-0{flex-grow:0!important}.flex-grow-1{flex-grow:1!important}.flex-shrink-0{flex-shrink:0!important}.flex-shrink-1{flex-shrink:1!important}.justify-content-start{justify-content:flex-start!important}.justify-content-end{justify-content:flex-end!important}.justify-content-center{justify-content:center!important}.justify-content-between{justify-content:space-between!important}.justify-content-around{justify-content:space-around!important}.align-items-start{align-items:flex-start!important}.align-items-end{align-items:flex-end!important}.align-items-center{align-items:center!important}.align-items-baseline{align-items:baseline!important}.align-items-stretch{align-items:stretch!important}.align-content-start{align-content:flex-start!important}.align-content-end{align-content:flex-end!important}.align-content-center{align-content:center!important}.align-content-between{align-content:space-between!important}.align-content-around{align-content:space-around!important}.align-content-stretch{align-content:stretch!important}.align-self-auto{align-self:auto!important}.align-self-start{align-self:flex-start!important}.align-self-end{align-self:flex-end!important}.align-self-center{align-self:center!important}.align-self-baseline{align-self:baseline!important}.align-self-stretch{align-self:stretch!important}</style><link href=/emfcloud/style.min.3ebbdeb85cb631a42d571aa14e34188cd928e4e5d2c714de80309f51001f3a94.css rel=stylesheet><link rel="shortcut icon" type=image/x-icon href=favicon.ico><link rel=icon sizes="16x16 32x32" type=image/x-icon href=/emfcloud/favicon.ico><link rel=icon href=/emfcloud/favicon.png><link rel=apple-touch-icon-precomposed href=/emfcloud/favicon.png><script>window.syna={};</script><script src=/emfcloud/scripts/syna-head.min.0757f18970a0a32d5acac5a2accc5fe82f787821866c545d9ed17ca765f291a3.js></script></head><body class=bg-secondary><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2375e895e9be4dc1a3672df5c8b9d320"}'></script><nav class="overlay fragment navbar navbar-expand-lg py-2 scroll-spy bg-light navbar-light" id=nav role=navigation><div class=container><a class="navbar-brand py-0" href=/emfcloud/#><img src=/emfcloud/images/logo.png height=35 class="d-inline-block align-top" alt="EMF Cloud"></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse justify-content-end collapse show" id=navbarCollapse><ul class=navbar-nav><li class=nav-item><a href=/emfcloud class=nav-link>Home</a></li><li class=nav-item><a href=/emfcloud/support class=nav-link>Support</a></li><li class=nav-item><a href=/emfcloud/documentation class=nav-link>Documentation</a></li><li class=nav-item><a href=/emfcloud/contact class=nav-link>Contact</a></li><li class=nav-item><a href=https://github.com/eclipse-emfcloud/emfcloud class=nav-link>GitHub</a></li></ul></div></div></nav><div class="scroll-to-top bg-primary has-font-icon" title="Back to top"><i class="fas fa-angle-up"></i><span class=sr-only>Back to top</span></div><section id=content class="fragment content-fragment"><div class="container-fluid bg-light overlay"><div class="container py-5 overlay"><div class=row><div class="content-sidebar col-md-3 pb-4 px-md-0 order-0"><div class="sticky-top pt-3"><div class="content-sidebar-body col-12 px-0 text-left text-body"><section id=sidebar class=fragment><div class="container p-0"><div class="row mx-0 text-body"><article id=list-page-overview class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-overview .collapse" data-add-collapse="#list-page-overview .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/overview/>Overview</a></h5></div></div><div class=collapse></div></article><article id=list-page-gettingstarted class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-gettingstarted .collapse" data-add-collapse="#list-page-gettingstarted .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/gettingstarted/>Getting Started</a></h5></div></div><div class=collapse></div></article><article id=list-page-coffeeeditorng class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-coffeeeditorng .collapse" data-add-collapse="#list-page-coffeeeditorng .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/coffeeeditorng/>Coffee Editor NG</a></h5></div></div><div class=collapse></div></article><article id=list-page-modelhub class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-modelhub .collapse" data-add-collapse="#list-page-modelhub .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/modelhub/>Model Hub</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/modelhub/#interacting-with-models>Interacting with models</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/modelhub/#contributing-modeling-languages>Contributing modeling languages</a></li></ul></li></ul></nav></div></div></section></div></article><article id=list-page-modelinglanguage class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-modelinglanguage .collapse" data-add-collapse="#list-page-modelinglanguage .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/modelinglanguage/>Language Definition</a></h5></div></div><div class=collapse></div></article><article id=list-page-langium class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-langium .collapse" data-add-collapse="#list-page-langium .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/langium/>Langium Integration</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/langium/#model-persistence>Model Persistence</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/langium/#model-validation>Model Validation</a></li></ul></nav></div></div></section></div></article><article id=list-page-editingdomain class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-editingdomain .collapse" data-add-collapse="#list-page-editingdomain .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/>Editing Domain</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#general-principles>General principles</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#model-service-implementation>Model Service implementation</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#command-stack-ids>Command Stack IDs</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#model-hub-context>Model Hub Context</a></li></ul></nav></div></div></section></div></article><article id=list-page-treeeditor class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-treeeditor .collapse" data-add-collapse="#list-page-treeeditor .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/>Tree-based Editors</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/#overview>Overview</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/#integrating-modelhub>Integrating ModelHub</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/#coffee-editor-ng-example>Coffee Editor NG Example</a></li></ul></nav></div></div></section></div></article><article id=list-page-diagrameditor class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-diagrameditor .collapse" data-add-collapse="#list-page-diagrameditor .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0 active-page"><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/>Diagram Editors</a></h5></div></div><div class="collapse show"><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#introduction>Introduction</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#modelhub-integration>ModelHub Integration</a><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#sourcemodelstorage>SourceModelStorage</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#gmodelfactory>GModelFactory</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#model-operations>Model Operations</a></li></ul></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#coffee-editor-ng-example>Coffee Editor NG Example</a><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#workflowmodelstorage>WorkflowModelStorage</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#coffeegmodelfactory>CoffeeGModelFactory</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#model-operations-via-the-coffeemodelservice>Model Operations via the CoffeeModelService</a></li></ul></li></ul></nav></div></div></section></div></article><article id=list-page-emf class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-emf .collapse" data-add-collapse="#list-page-emf .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/emf/>EMF Support</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/emf/#emf-model-server>EMF Model Server</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/emf/#emf-coffee-editor>EMF Coffee Editor</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/emf/#getting-started>Getting Started</a></li></ul></nav></div></div></section></div></article><article id=list-page-additionals class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-additionals .collapse" data-add-collapse="#list-page-additionals .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/additionals/>More Articles & Videos</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/additionals/#articles>Articles</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/additionals/#videos>Videos</a></li></ul></nav></div></div></section></div></article></div></div></section></div></div></div><article class=col-md-9><div class="title-container row mx-0"><div class="title col px-0 text-center text-body"><h2>Diagram Editors</h2></div></div><div class="content-body col-12 content px-0 text-body"><section id=content-toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#introduction>Introduction</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#modelhub-integration>ModelHub Integration</a><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#sourcemodelstorage>SourceModelStorage</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#gmodelfactory>GModelFactory</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#model-operations>Model Operations</a></li></ul></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#coffee-editor-ng-example>Coffee Editor NG Example</a><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#workflowmodelstorage>WorkflowModelStorage</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#coffeegmodelfactory>CoffeeGModelFactory</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#model-operations-via-the-coffeemodelservice>Model Operations via the CoffeeModelService</a></li></ul></li></ul></nav></div></div></section><div style=text-align:center;margin-top:50px;margin-bottom:50px><img src=../../images/diagramanimated.gif alt="Overview of the Model Hub for the Coffee Editor NG" width=80%></div><h2 id=introduction>Introduction</h2><p>The foundation of implementing diagram editors is the <a href=https://eclipse.dev/glsp/>GLSP framework</a>.
This guide will give an introduction to connect GLSP diagram editors with the <a href=https://github.com/eclipsesource/coffee-editor/tree/main/emfcloud-modelmanager/model-service-theia>ModelHub</a>.
Specifically, the GLSP diagram editor makes use of the <code>ModelHub</code> and the interfaces of the <code>ModelService</code> like the <code>CoffeeModelServer</code> or the <code>CoffeeModelService</code> for seamless integration and outsourced data management.
Furthermore, specific examples of the <a href=#coffee-editor-ng-example>Coffee Editor NG implementation</a> will be given as a guideline.</p><h2 id=modelhub-integration>ModelHub Integration</h2></br><h3 id=sourcemodelstorage>SourceModelStorage</h3><p>A source model storage handles the persistence of source models, i.e. loading and saving it from/into the model state.
A <code>source model</code> is an arbitrary model from which the graph model of the diagram is to be created.
A source model loader obtains the information on which source model shall loaded from a
RequestModelAction; typically its client options. Once the source model is loaded, a model loader is expected
to put the loaded source model into the model state for further processing, such as transforming the loaded model
into a graph model (see <a href=#gmodelfactory>GModelFactory</a> below).
On <code>saveSourceModel(SaveModelAction)</code>, the source model storage persists the source model from the model state.</p><p>In our case all of these responsibilites are outsourced to the <code>ModelHub</code>, namely the model loading, subscribing to model changes, dirty state information and triggering the save of the model.</p><h3 id=gmodelfactory>GModelFactory</h3><p>A graph model factory produces a graph model from the source model contained in the model state.</p><p>In this case, we also use the source model from the model state to translate the source model into <code>GModelRoot</code>. For more complex translations, e.g. for creating edges, the <code>CoffeeModelServer</code> is used to resolve references.</p><h3 id=model-operations>Model Operations</h3><p>To outsource the responsibility of executing operations directly on the model, operations should be forwarded to the <a href=/emfcloud/documentation/editingdomain/#model-service-implementation>CoffeeModelService</a>.
The <code>CoffeeModelService</code> offers tailored functions to manipulate the model, e.g. dedicated create or delete functions that take as arguments the specific diagram data like the position on the canvas.</p><h2 id=coffee-editor-ng-example>Coffee Editor NG Example</h2></br><h3 id=workflowmodelstorage>WorkflowModelStorage</h3><p>The <code>WorkflowModelStorage</code> is responsible for loading and saving source models via the <code>ModelHub</code>.</p><h4 id=load-the-source-model>Load the source model</h4><p>To load the source model for further usage and transformation into the graphical GModel, we fetch the <code>CoffeeModelRoot</code> from the <code>modelHub</code> as follows:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>getModel</span>&lt;<span style=color:#f92672>CoffeeModelRoot</span>&gt;(<span style=color:#a6e22e>modelUri</span>);
</code></pre></div><details><summary>Detailed implementation</summary><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>loadSourceModel</span>(<span style=color:#a6e22e>action</span>: <span style=color:#66d9ef>RequestModelAction</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>modelUri</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getUri</span>(<span style=color:#a6e22e>action</span>);
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>coffeeModel</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>getModel</span>&lt;<span style=color:#f92672>CoffeeModelRoot</span>&gt;(<span style=color:#a6e22e>modelUri</span>);
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>coffeeModel</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isMachine</span>(<span style=color:#a6e22e>coffeeModel</span>) <span style=color:#f92672>||</span> (<span style=color:#a6e22e>isMachine</span>(<span style=color:#a6e22e>coffeeModel</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>coffeeModel</span>.<span style=color:#a6e22e>workflows</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>)) {
      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GLSPServerError</span>(<span style=color:#e6db74>&#39;Expected Coffee Model with at least one workflow&#39;</span>);
    }
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>.<span style=color:#a6e22e>setSemanticRoot</span>(<span style=color:#a6e22e>modelUri</span>, <span style=color:#a6e22e>coffeeModel</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscribeToChanges</span>(<span style=color:#a6e22e>modelUri</span>);
  }
</code></pre></div></details></br><h4 id=subscribe-to-model-changes>Subscribe to model changes</h4><p>To subscribe to model changes, <code>modelHub</code> offers a <code>subscribe</code> function:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscription</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>modelUri</span>);
<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscription</span>.<span style=color:#a6e22e>onModelChanged</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>modelId</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>newModel</span>: <span style=color:#66d9ef>object</span>) <span style=color:#f92672>=&gt;</span> {
  <span style=color:#75715e>// handle model update
</span><span style=color:#75715e></span>}
</code></pre></div><details><summary>Detailed implementation</summary><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>private</span> <span style=color:#a6e22e>subscribeToChanges</span>(<span style=color:#a6e22e>modelUri</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscription</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>subscribe</span>(<span style=color:#a6e22e>modelUri</span>);
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>subscription</span>.<span style=color:#a6e22e>onModelChanged</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>modelId</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>newModel</span>: <span style=color:#66d9ef>object</span>) <span style=color:#f92672>=&gt;</span> {
      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>newModel</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>isMachine</span>(<span style=color:#a6e22e>newModel</span>) <span style=color:#f92672>||</span> <span style=color:#a6e22e>newModel</span>.<span style=color:#a6e22e>workflows</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>) {
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>GLSPServerError</span>(<span style=color:#e6db74>&#39;Expected Coffee Model with at least one workflow&#39;</span>);
      }
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>.<span style=color:#a6e22e>setSemanticRoot</span>(<span style=color:#a6e22e>modelId</span>, <span style=color:#a6e22e>newModel</span>);
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>actions</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>submissionHandler</span>.<span style=color:#a6e22e>submitModel</span>();
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dirtyStateAction</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>actions</span>.<span style=color:#a6e22e>find</span>(<span style=color:#a6e22e>action</span> <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>kind</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>SetDirtyStateAction</span>.<span style=color:#a6e22e>KIND</span>);
      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>dirtyStateAction</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>SetDirtyStateAction</span>.<span style=color:#66d9ef>is</span>(<span style=color:#a6e22e>dirtyStateAction</span>)) {
        <span style=color:#a6e22e>dirtyStateAction</span>.<span style=color:#a6e22e>isDirty</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>isDirty</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>.<span style=color:#a6e22e>semanticUri</span>);
      }
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>actionDispatcher</span>.<span style=color:#a6e22e>dispatchAll</span>(<span style=color:#a6e22e>actions</span>);
    };
  }
</code></pre></div></details></br><h4 id=save-model>Save model</h4><p>To trigger model saving, <code>modelHub</code> offers a <code>save</code> function:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>modelUri</span>)
</code></pre></div><details><summary>Detailed implementation</summary
<div class="highlight"><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>async</span> <span style=color:#a6e22e>saveSourceModel</span>(<span style=color:#a6e22e>action</span>: <span style=color:#66d9ef>SaveModelAction</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>modelUri</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>fileUri</span> <span style=color:#f92672>??</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>.<span style=color:#a6e22e>semanticUri</span>;
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>modelUri</span>) {
      <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>modelUri</span>);
    }
  }
</code></pre></div></details></br><h3 id=coffeegmodelfactory>CoffeeGModelFactory</h3><p>To resolve references, such as edge sources or targets, we use the <code>CoffeeModelServer</code> to get the resolved data needed to properly translate the source model into a <code>GModelRoot</code>.</p><p>This shows one flow from the example source model <code>superbrewer3000.coffee</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>  <span style=color:#960050;background-color:#1e0010>...</span>
  {
    <span style=color:#f92672>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;checkWaterToDecision&#34;</span>,
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;Flow&#34;</span>,
    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;SuperBrewer3000.BrewingFlow.Check Water&#34;</span>,
    <span style=color:#f92672>&#34;target&#34;</span>: <span style=color:#e6db74>&#34;SuperBrewer3000.BrewingFlow.MyDecision&#34;</span>
  }<span style=color:#960050;background-color:#1e0010>,</span>
  <span style=color:#960050;background-color:#1e0010>...</span>
</code></pre></div><p>The following snippet shows how to create a GEdge from such a flow object:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>@inject</span>(<span style=color:#a6e22e>CoffeeModelServer</span>)
  <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>modelServer</span>: <span style=color:#66d9ef>CoffeeModelServer</span>;

  ...

  <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createEdge</span>(<span style=color:#a6e22e>edge</span>: <span style=color:#66d9ef>Flow</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>GEdge</span>&gt; {
    <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>sourceNode</span>, <span style=color:#a6e22e>targetNode</span>] <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>Promise</span>.<span style=color:#a6e22e>all</span>([
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelServer</span>.<span style=color:#a6e22e>resolve</span>&lt;<span style=color:#f92672>Node</span>&gt;(<span style=color:#a6e22e>edge</span>.<span style=color:#a6e22e>source</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>Required</span>&lt;<span style=color:#f92672>NodeReferenceInfo</span>&gt;),
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelServer</span>.<span style=color:#a6e22e>resolve</span>&lt;<span style=color:#f92672>Node</span>&gt;(<span style=color:#a6e22e>edge</span>.<span style=color:#a6e22e>target</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>Required</span>&lt;<span style=color:#f92672>NodeReferenceInfo</span>&gt;)
    ]);
    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>GEdge</span>.<span style=color:#a6e22e>builder</span>()
      .<span style=color:#a6e22e>id</span>(<span style=color:#a6e22e>edge</span>.<span style=color:#a6e22e>id</span>)
      .<span style=color:#a6e22e>sourceId</span>(<span style=color:#a6e22e>sourceNode</span>.<span style=color:#a6e22e>id</span>)
      .<span style=color:#a6e22e>targetId</span>(<span style=color:#a6e22e>targetNode</span>.<span style=color:#a6e22e>id</span>)
      .<span style=color:#a6e22e>build</span>();
  }

</code></pre></div><h3 id=model-operations-via-the-coffeemodelservice>Model Operations via the CoffeeModelService</h3><p>To showcase how to forward model operations to the <a href=/emfcloud/documentation/editingdomain/#model-service-implementation>CoffeeModelService</a>,
let&rsquo;s take a look at the <code>CreateWorkflowNodeOperationHandler</code>.
This handler is an abstract node creation operation handler that is used to create all possible types of nodes supported by the Coffee diagram editor, e.g. manual tasks or fork nodes.</p><p>We wrap the model operation in a <code>GModelRecordingCommand</code> - in our case a customized <code>CoffeeModelCommand</code> that aligns the customized types of the <code>GModelState</code> for example.
The model operation itself is basically the operation data collection we get from the diagram editor, which we hand over to the <code>CoffeeModelService</code>.
The modelService provides a dedicated function to create a new node, expecting the diagram editor&rsquo;s specific data like position and type of node.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript>  <span style=color:#a6e22e>override</span> <span style=color:#a6e22e>createCommand</span>(<span style=color:#a6e22e>operation</span>: <span style=color:#66d9ef>CreateNodeOperation</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>MaybePromise</span>&lt;<span style=color:#f92672>Command</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>undefined</span>&gt; {
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CoffeeModelCommand</span>(
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>,
      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>serializer</span>,
      () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>createWorkflowNode</span>(<span style=color:#a6e22e>operation</span>)
    );
  }

  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createWorkflowNode</span>(<span style=color:#a6e22e>operation</span>: <span style=color:#66d9ef>CreateNodeOperation</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>container</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>.<span style=color:#a6e22e>semanticRoot</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>modelService</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelHub</span>.<span style=color:#a6e22e>getModelService</span>&lt;<span style=color:#f92672>CoffeeModelService</span>&gt;(<span style=color:#a6e22e>COFFEE_SERVICE_KEY</span>);
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>modelId</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelState</span>.<span style=color:#a6e22e>semanticUri</span>;
    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>modelService</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>modelId</span>, <span style=color:#a6e22e>container</span>.<span style=color:#a6e22e>workflows</span>[<span style=color:#ae81ff>0</span>], {
      <span style=color:#a6e22e>posX</span>: <span style=color:#66d9ef>this.getLocation</span>(<span style=color:#a6e22e>operation</span>)<span style=color:#f92672>?</span>.<span style=color:#a6e22e>x</span> <span style=color:#f92672>??</span> <span style=color:#a6e22e>Point</span>.<span style=color:#a6e22e>ORIGIN</span>.<span style=color:#a6e22e>x</span>,
      <span style=color:#a6e22e>posY</span>: <span style=color:#66d9ef>this.getLocation</span>(<span style=color:#a6e22e>operation</span>)<span style=color:#f92672>?</span>.<span style=color:#a6e22e>y</span> <span style=color:#f92672>??</span> <span style=color:#a6e22e>Point</span>.<span style=color:#a6e22e>ORIGIN</span>.<span style=color:#a6e22e>y</span>,
      <span style=color:#66d9ef>type</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getNodeType</span>(<span style=color:#a6e22e>operation</span>)
    });
  }
</code></pre></div><p>Similarly, this is the way to implement model operations, also for other diagram editor use cases like deleting model elements, resizing or repostioning model elements or edit model element labels.</p></div></article></div></div></div></section><section id=footer class=fragment><div class="container-fluid bg-light"><div class="container py-5"><div class=row><div class="col-md m-2 text-body"><h4></h4><a href=#><img src=/emfcloud/images/logo.png class="img-fluid w-50" alt="EMF Cloud"></a><div class="row justify-content-left ml-0"><span class="fa-stack fa-2x mt-3 mr-1" title=twitter><a href=https://twitter.com/emfcloud class=ignore-color-change><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-twitter fa-stack-1x fa-fw text-light"></i><span class=sr-only>twitter</span></a></span>
<span class="fa-stack fa-2x mt-3 mr-1" title=github><a href=https://github.com/eclipse-emfcloud/emfcloud class=ignore-color-change><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-fw text-light"></i><span class=sr-only>github</span></a></span>
<span class="fa-stack fa-2x mt-3 mr-1" title=github-discussions><a href=https://github.com/eclipse-emfcloud/emfcloud/discussions class=ignore-color-change><i class="fas fa-circle fa-stack-2x"></i><i class="far fa-comments fa-stack-1x fa-fw text-light"></i><span class=sr-only>github-discussions</span></a></span></div></div><div class="col-md m-2 text-body"><h4>Related Projects</h4><ul class="nav flex-column"><li class=nav-item><a class="nav-link p-0 display-5" href=https://eclipse.dev/glsp>Eclipse GLSP</a></li><li class=nav-item><a class="nav-link p-0 display-5" href=https://jsonforms.io>JSON Forms</a></li><li class=nav-item><a class="nav-link p-0 display-5" href=https://eclipsesource.com/technology/eclipse-theia>Eclipse Theia IDE</a></li><li class=nav-item><a class="nav-link p-0 display-5" href=https://eclipse.dev/che>Eclipse Che</a></li></ul></div><div class="col-md m-2 text-body"><div><h4 id=emf-cloud>EMF Cloud</h4><p>EMF Cloud is a project hosted at the <a href=https://eclipse.org>Eclipse Foundation</a>, lead by <a href=https://projects.eclipse.org/projects/ecd.emfcloud/who>Eugen, Philip and Maximilian</a>, organized within the <a href=https://projects.eclipse.org/projects/ecd>Eclipse Cloud Development</a> project.</p><p>Gefördert durch: <img src=/emfcloud/images/BMBF_Logo.svg alt="BMBG Logo"></p></div></div></div></div></div></section><footer class="overlay fragment container-fluid bg-secondary" id=copyright><div class=container><div class="row py-3"><div class=col-md><div class="row mx-0 my-2 justify-content-center text-center text-lg-none text-black-50"><div class="row mx-0 mr-lg-auto justify-content-center"><div class="col-auto px-1 copyright-legal">© Copyright&nbsp;2023</div><div class="col-auto px-0 copyright-by">by Eclipse Foundation</div></div></div></div><div class=col-md><div class="row mx-0 my-2 justify-content-center"><ul class="nav ml-lg-auto"><li class=nav-item><a class="nav-link py-0" href=https://projects.eclipse.org/projects/ecd.emfcloud>About</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/copyright.php>Copyright</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/>Legal</a></li></ul></div></div></div></div></footer><div id=react></div><script async defer src=/emfcloud/scripts/syna-main.min.68ae1ae47948304c9c224cfc1a97ffe16c57514bc587dd6140dcb82389a8d299.js></script><script async defer src=/emfcloud/scripts/syna-content.min.bf537eb5ace369e45e8b4ed41b8d235a65db92236a400ed5659f7a3c41d0f221.js></script><script async defer src=/emfcloud/scripts/syna-collapse.min.1f6ca6206008af133f158e2b7b650b4156b8fc33189c5a6142db3bb43c7ad8e7.js></script></body></html>