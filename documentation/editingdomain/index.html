<!doctype html><html lang=en-us><head><meta name=theme content="Syna"><meta name=theme-version content="v0.17.2"><meta name=theme-url content="https://syna.okkur.org"><meta name=theme-description content="Highly customizable open source theme for Hugo based static websites"><meta name=theme-author content="Okkur Labs"><meta name=theme-author-url content="https://about.okkur.org"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=google content="notranslate"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=description content="General principles Edition of models is handled by the ModelManager, by executing Commands on one or several CommandStacks. The ModelManager is not directly exposed by the ModelHub API, so it is not (easily) possible to execute arbitrary commands on arbitrary models. Instead, the ModelManager is passed to ModelServiceContributions, which can then use it in their custom ModelService implementation to execute commands. This way, clients do not have to deal with Commands directly, but simply interact with the custom API."><meta property="og:title" content="Editing Domain"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://www.eclipse.dev/emfcloud/documentation/editingdomain/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Editing Domain &amp;middot; EMF Cloud"><meta name=twitter:description content="General principles Edition of models is handled by the ModelManager, by executing Commands on one or several CommandStacks. The ModelManager is not directly exposed by the ModelHub API, so it is not (easily) possible to execute arbitrary commands on arbitrary models. Instead, the ModelManager is passed to ModelServiceContributions, which can then use it in their custom ModelService implementation to execute commands. This way, clients do not have to deal with Commands directly, but simply interact with the custom API."><meta name=twitter:url content="https://www.eclipse.dev/emfcloud/documentation/editingdomain/"><meta property="og:image" content><meta name=twitter:image content><meta name=author content="Eclipse Foundation"><meta name=generator content="Hugo 0.78.1"><title>Editing Domain &#183; EMF Cloud</title><style>.mx-0{margin-left:0!important;margin-right:0!important}@-ms-viewport{width: device-width; }html{box-sizing:border-box;-ms-overflow-style:scrollbar}*,*::before,*::after{box-sizing:inherit}.container{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;max-width:540px;max-width:720px;max-width:960px;max-width:1140px}.container-fluid{width:100%;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}.row{display:flex;flex-wrap:wrap;margin-right:-15px;margin-left:-15px}.no-gutters{margin-right:0;margin-left:0}.no-gutters>.col,.no-gutters>[class*=col-]{padding-right:0;padding-left:0}.col-1,.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9,.col-10,.col-11,.col-12,.col,.col-auto{position:relative;width:100%;min-height:1px;padding-right:15px;padding-left:15px}.col{flex-basis:0;flex-grow:1;max-width:100%}.col-auto{flex:0 0 auto;width:auto;max-width:none}.col-1{flex:0 0 8.33333%;max-width:8.33333%}.col-2{flex:0 0 16.66667%;max-width:16.66667%}.col-3{flex:0 0 25%;max-width:25%}.col-4{flex:0 0 33.33333%;max-width:33.33333%}.col-5{flex:0 0 41.66667%;max-width:41.66667%}.col-6{flex:0 0 50%;max-width:50%}.col-7{flex:0 0 58.33333%;max-width:58.33333%}.col-8{flex:0 0 66.66667%;max-width:66.66667%}.col-9{flex:0 0 75%;max-width:75%}.col-10{flex:0 0 83.33333%;max-width:83.33333%}.col-11{flex:0 0 91.66667%;max-width:91.66667%}.col-12{flex:0 0 100%;max-width:100%}.order-first{order:-1}.order-last{order:13}.order-0{order:0}.order-1{order:1}.order-2{order:2}.order-3{order:3}.order-4{order:4}.order-5{order:5}.order-6{order:6}.order-7{order:7}.order-8{order:8}.order-9{order:9}.order-10{order:10}.order-11{order:11}.order-12{order:12}.offset-1{margin-left:8.33333%}.offset-2{margin-left:16.66667%}.offset-3{margin-left:25%}.offset-4{margin-left:33.33333%}.offset-5{margin-left:41.66667%}.offset-6{margin-left:50%}.offset-7{margin-left:58.33333%}.offset-8{margin-left:66.66667%}.offset-9{margin-left:75%}.offset-10{margin-left:83.33333%}.offset-11{margin-left:91.66667%}.d-none{display:none!important}.d-inline{display:inline!important}.d-inline-block{display:inline-block!important}.d-block{display:block!important}.d-table{display:table!important}.d-table-row{display:table-row!important}.d-table-cell{display:table-cell!important}.d-flex{display:flex!important}.d-inline-flex{display:inline-flex!important}@media print{.d-print-none{display:none!important}.d-print-inline{display:inline!important}.d-print-inline-block{display:inline-block!important}.d-print-block{display:block!important}.d-print-table{display:table!important}.d-print-table-row{display:table-row!important}.d-print-table-cell{display:table-cell!important}.d-print-flex{display:flex!important}.d-print-inline-flex{display:inline-flex!important}}.flex-row{flex-direction:row!important}.flex-column{flex-direction:column!important}.flex-row-reverse{flex-direction:row-reverse!important}.flex-column-reverse{flex-direction:column-reverse!important}.flex-wrap{flex-wrap:wrap!important}.flex-nowrap{flex-wrap:nowrap!important}.flex-wrap-reverse{flex-wrap:wrap-reverse!important}.flex-fill{flex:1 1 auto!important}.flex-grow-0{flex-grow:0!important}.flex-grow-1{flex-grow:1!important}.flex-shrink-0{flex-shrink:0!important}.flex-shrink-1{flex-shrink:1!important}.justify-content-start{justify-content:flex-start!important}.justify-content-end{justify-content:flex-end!important}.justify-content-center{justify-content:center!important}.justify-content-between{justify-content:space-between!important}.justify-content-around{justify-content:space-around!important}.align-items-start{align-items:flex-start!important}.align-items-end{align-items:flex-end!important}.align-items-center{align-items:center!important}.align-items-baseline{align-items:baseline!important}.align-items-stretch{align-items:stretch!important}.align-content-start{align-content:flex-start!important}.align-content-end{align-content:flex-end!important}.align-content-center{align-content:center!important}.align-content-between{align-content:space-between!important}.align-content-around{align-content:space-around!important}.align-content-stretch{align-content:stretch!important}.align-self-auto{align-self:auto!important}.align-self-start{align-self:flex-start!important}.align-self-end{align-self:flex-end!important}.align-self-center{align-self:center!important}.align-self-baseline{align-self:baseline!important}.align-self-stretch{align-self:stretch!important}</style><link href=/emfcloud/style.min.3ebbdeb85cb631a42d571aa14e34188cd928e4e5d2c714de80309f51001f3a94.css rel=stylesheet><link rel="shortcut icon" type=image/x-icon href=favicon.ico><link rel=icon sizes="16x16 32x32" type=image/x-icon href=/emfcloud/favicon.ico><link rel=icon href=/emfcloud/favicon.png><link rel=apple-touch-icon-precomposed href=/emfcloud/favicon.png><script>window.syna={};</script><script src=/emfcloud/scripts/syna-head.min.0757f18970a0a32d5acac5a2accc5fe82f787821866c545d9ed17ca765f291a3.js></script></head><body class=bg-secondary><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "2375e895e9be4dc1a3672df5c8b9d320"}'></script><nav class="overlay fragment navbar navbar-expand-lg py-2 scroll-spy bg-light navbar-light" id=nav role=navigation><div class=container><a class="navbar-brand py-0" href=/emfcloud/#><img src=/emfcloud/images/logo.png height=35 class="d-inline-block align-top" alt="EMF Cloud"></a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarCollapse aria-controls=navbarCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="navbar-collapse justify-content-end collapse show" id=navbarCollapse><ul class=navbar-nav><li class=nav-item><a href=/emfcloud class=nav-link>Home</a></li><li class=nav-item><a href=/emfcloud/support class=nav-link>Support</a></li><li class=nav-item><a href=/emfcloud/documentation class=nav-link>Documentation</a></li><li class=nav-item><a href=/emfcloud/contact class=nav-link>Contact</a></li><li class=nav-item><a href=https://github.com/eclipse-emfcloud/emfcloud class=nav-link>GitHub</a></li></ul></div></div></nav><div class="scroll-to-top bg-primary has-font-icon" title="Back to top"><i class="fas fa-angle-up"></i><span class=sr-only>Back to top</span></div><section id=content class="fragment content-fragment"><div class="container-fluid bg-light overlay"><div class="container py-5 overlay"><div class=row><div class="content-sidebar col-md-3 pb-4 px-md-0 order-0"><div class="sticky-top pt-3"><div class="content-sidebar-body col-12 px-0 text-left text-body"><section id=sidebar class=fragment><div class="container p-0"><div class="row mx-0 text-body"><article id=list-page-overview class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-overview .collapse" data-add-collapse="#list-page-overview .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/overview/>Overview</a></h5></div></div><div class=collapse></div></article><article id=list-page-gettingstarted class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-gettingstarted .collapse" data-add-collapse="#list-page-gettingstarted .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/gettingstarted/>Getting Started</a></h5></div></div><div class=collapse></div></article><article id=list-page-coffeeeditorng class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-coffeeeditorng .collapse" data-add-collapse="#list-page-coffeeeditorng .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/coffeeeditorng/>Coffee Editor NG</a></h5></div></div><div class=collapse></div></article><article id=list-page-modelhub class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-modelhub .collapse" data-add-collapse="#list-page-modelhub .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/modelhub/>Model Hub</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/modelhub/#interacting-with-models>Interacting with models</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/modelhub/#contributing-modeling-languages>Contributing modeling languages</a></li></ul></li></ul></nav></div></div></section></div></article><article id=list-page-modelinglanguage class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-modelinglanguage .collapse" data-add-collapse="#list-page-modelinglanguage .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/modelinglanguage/>Language Definition</a></h5></div></div><div class=collapse></div></article><article id=list-page-langium class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-langium .collapse" data-add-collapse="#list-page-langium .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/langium/>Langium Integration</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/langium/#model-persistence>Model Persistence</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/langium/#model-validation>Model Validation</a></li></ul></nav></div></div></section></div></article><article id=list-page-editingdomain class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-editingdomain .collapse" data-add-collapse="#list-page-editingdomain .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0 active-page"><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/>Editing Domain</a></h5></div></div><div class="collapse show"><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#general-principles>General principles</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#model-service-implementation>Model Service implementation</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#command-stack-ids>Command Stack IDs</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#model-hub-context>Model Hub Context</a></li></ul></nav></div></div></section></div></article><article id=list-page-treeeditor class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-treeeditor .collapse" data-add-collapse="#list-page-treeeditor .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/>Tree-based Editors</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/#overview>Overview</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/#integrating-modelhub>Integrating ModelHub</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/treeeditor/#coffee-editor-ng-example>Coffee Editor NG Example</a></li></ul></nav></div></div></section></div></article><article id=list-page-diagrameditor class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-diagrameditor .collapse" data-add-collapse="#list-page-diagrameditor .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/>Diagram Editors</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#introduction>Introduction</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#modelhub-integration>ModelHub Integration</a><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#sourcemodelstorage>SourceModelStorage</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#gmodelfactory>GModelFactory</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#model-operations>Model Operations</a></li></ul></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#coffee-editor-ng-example>Coffee Editor NG Example</a><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#workflowmodelstorage>WorkflowModelStorage</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#coffeegmodelfactory>CoffeeGModelFactory</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/diagrameditor/#model-operations-via-the-coffeemodelservice>Model Operations via the CoffeeModelService</a></li></ul></li></ul></nav></div></div></section></div></article><article id=list-page-emf class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-emf .collapse" data-add-collapse="#list-page-emf .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/emf/>EMF Support</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/emf/#emf-model-server>EMF Model Server</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/emf/#emf-coffee-editor>EMF Coffee Editor</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/emf/#getting-started>Getting Started</a></li></ul></nav></div></div></section></div></article><article id=list-page-additionals class="col-12 px-0 mb-2"><div class="col-12 pl-0 pb-1 text-body"><div data-toggle=collapse data-target="#list-page-additionals .collapse" data-add-collapse="#list-page-additionals .article-title" class="row align-items-center justify-content-between mx-0 article-title"><h5 class="col px-0 m-0"><a href=https://www.eclipse.dev/emfcloud/documentation/additionals/>More Articles & Videos</a></h5></div></div><div class=collapse><section id=toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/additionals/#articles>Articles</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/additionals/#videos>Videos</a></li></ul></nav></div></div></section></div></article></div></div></section></div></div></div><article class=col-md-9><div class="title-container row mx-0"><div class="title col px-0 text-center text-body"><h2>Editing Domain</h2></div></div><div class="content-body col-12 content px-0 text-body"><section id=content-toc class=fragment><div class="container p-0"><div class=toc><nav id=TableOfContents><ul><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#general-principles>General principles</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#model-service-implementation>Model Service implementation</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#command-stack-ids>Command Stack IDs</a></li><li><a href=https://www.eclipse.dev/emfcloud/documentation/editingdomain/#model-hub-context>Model Hub Context</a></li></ul></nav></div></div></section><h2 id=general-principles>General principles</h2><p>Edition of models is handled by the ModelManager, by executing Commands on one or several CommandStacks. The ModelManager is not directly exposed by the ModelHub API, so it is not (easily) possible to execute arbitrary commands on arbitrary models. Instead, the ModelManager is passed to ModelServiceContributions, which can then use it in their custom ModelService implementation to execute commands. This way, clients do not have to deal with Commands directly, but simply interact with the custom API.</p><h2 id=model-service-implementation>Model Service implementation</h2><p>As seen in the <a href=/emfcloud/documentation/modelhub/>ModelHub section</a>, the ModelServiceContribution is the entry point for model-specific contributions. Upon initialization of the ModelHub, each contribution will get access to the ModelManager, and should typically forward it to their ModelService implementation.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>@injectable</span>()
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoffeeModelServiceContribution</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>AbstractModelServiceContribution</span> {
  <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>modelService</span>: <span style=color:#66d9ef>CoffeeModelService</span>;

  <span style=color:#66d9ef>@postConstruct</span>()
  <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>init</span>()<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>initialize</span>({
      <span style=color:#a6e22e>id</span>: <span style=color:#66d9ef>COFFEE_SERVICE_KEY</span>
    })
  }

  <span style=color:#a6e22e>getModelService</span>&lt;<span style=color:#f92672>S</span>&gt;()<span style=color:#f92672>:</span> <span style=color:#a6e22e>S</span> {
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelService</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>unknown</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>S</span>;
  }

  <span style=color:#a6e22e>setModelManager</span>(<span style=color:#a6e22e>modelManager</span>: <span style=color:#66d9ef>ModelManager</span>)<span style=color:#f92672>:</span> <span style=color:#66d9ef>void</span> {
    <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>setModelManager</span>(<span style=color:#a6e22e>modelManager</span>);
    <span style=color:#75715e>// Forward the model manager to our model service, so it can actually
</span><span style=color:#75715e></span>    <span style=color:#75715e>// execute some commands.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelService</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CoffeeModelServiceImpl</span>(<span style=color:#a6e22e>modelManager</span>);
  }
}
</code></pre></div><p>Then, the ModelService implementation can access the model and execute Commands on the ModelManager:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoffeeModelServiceImpl</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>CoffeeModelService</span> {
  <span style=color:#66d9ef>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>modelManager</span>: <span style=color:#66d9ef>ModelManager</span>&lt;<span style=color:#f92672>string</span>&gt;) {}

  <span style=color:#75715e>// clients could directly access the model from the Model Hub, but 
</span><span style=color:#75715e></span>  <span style=color:#75715e>// custom ModelService APIs can also provide a convenience method:
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>getCoffeeModel</span>(<span style=color:#a6e22e>modelUri</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>CoffeeModelRoot</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>undefined</span>&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getModelKey</span>(<span style=color:#a6e22e>modelUri</span>);
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelManager</span>.<span style=color:#a6e22e>getModel</span>&lt;<span style=color:#f92672>CoffeeModelRoot</span>&gt;(<span style=color:#a6e22e>key</span>);
  }

  <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>
  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>modelUri</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>parent</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Workflow</span>, <span style=color:#a6e22e>args</span>: <span style=color:#66d9ef>CreateNodeArgs</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>PatchResult</span>&gt; {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getCoffeeModel</span>(<span style=color:#a6e22e>modelUri</span>);
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>model</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
      <span style=color:#66d9ef>return</span> {
        <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>false</span>,
        <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Failed to edit </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>modelUri</span>.<span style=color:#a6e22e>toString</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>: Model not found`</span>
      };
    }

    <span style=color:#75715e>// parent can be either the element itself, or its path. Resolve the
</span><span style=color:#75715e></span>    <span style=color:#75715e>// correct element.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parentPath</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getParentPath</span>(<span style=color:#a6e22e>model</span>, <span style=color:#a6e22e>parent</span>);
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parentElement</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getValueByPointer</span>(<span style=color:#a6e22e>model</span>, <span style=color:#a6e22e>parentPath</span>);
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isWorkflow</span>(<span style=color:#a6e22e>parentElement</span>)) {
      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Parent element is not a Workflow: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>parentPath</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
    }

    <span style=color:#75715e>// create the new Node (regular JSON object)
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>args</span>.<span style=color:#66d9ef>type</span>, <span style=color:#a6e22e>parentElement</span>, <span style=color:#a6e22e>args</span>);

    <span style=color:#75715e>// create a JSON patch to edit the model
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>patch</span>: <span style=color:#66d9ef>Operation</span>[] <span style=color:#f92672>=</span> [
      {
        <span style=color:#a6e22e>op</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;add&#39;</span>,
        <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>parentPath</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/nodes/-`</span>,
        <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>newNode</span>
      }
    ];
    
    <span style=color:#75715e>// get the command stack. In this case, we don&#39;t have multi-model command stacks,
</span><span style=color:#75715e></span>    <span style=color:#75715e>// so just use the modelUri as the command stack id.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stackId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getStackId</span>(<span style=color:#a6e22e>modelUri</span>);
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stack</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>modelManager</span>.<span style=color:#a6e22e>getCommandStack</span>(<span style=color:#a6e22e>stackId</span>);

    <span style=color:#75715e>// create the Command from the JSON Patch and execute it
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PatchCommand</span>(<span style=color:#e6db74>&#39;Create Node&#39;</span>, <span style=color:#a6e22e>modelUri</span>, <span style=color:#a6e22e>patch</span>);
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>command</span>);

    <span style=color:#75715e>// Return a patch result that indicates success or failure, and applied changes
</span><span style=color:#75715e></span>    <span style=color:#75715e>// in case of success.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>patchResult</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span><span style=color:#f92672>?</span>.<span style=color:#66d9ef>get</span>(<span style=color:#a6e22e>command</span>);
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>patchResult</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>undefined</span>) {
      <span style=color:#66d9ef>return</span> {
        <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>false</span>,
        <span style=color:#a6e22e>error</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Failed to edit </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>modelUri</span>.<span style=color:#a6e22e>toString</span>()<span style=color:#e6db74>}</span><span style=color:#e6db74>: Model edition failed`</span>
      };
    }
    <span style=color:#66d9ef>return</span> {
      <span style=color:#a6e22e>success</span>: <span style=color:#66d9ef>true</span>,
      <span style=color:#a6e22e>patch</span>: <span style=color:#66d9ef>patchResult</span>
    };
  }
}
</code></pre></div><p>There are several ways to create patch commands. In the above example, we created the JSON Patch manually, using the JSON pointer path from the parent, and adding a value. However, using a JSON Patch Library (such as <code>fast-json-patch</code>, although any similar library can be used), one could generate the patch instead:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoffeeModelServiceImpl</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>CoffeeModelService</span> {

  <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>
  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>modelUri</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>parentPath</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>PatchResult</span>&gt; {
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getCoffeeModel</span>(<span style=color:#a6e22e>modelUri</span>);

      <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>
      <span style=color:#75715e>// We are not allowed to edit the `model` object directly. Make a copy, 
</span><span style=color:#75715e></span>      <span style=color:#75715e>// and then we&#39;ll use fast-json-patch to generate a diff-patch.
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>updatedModel</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>deepClone</span>(<span style=color:#a6e22e>model</span>) <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>CoffeeModelRoot</span>;
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>updatedWorkflow</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getValueByPointer</span>(<span style=color:#a6e22e>updatedModel</span>, <span style=color:#a6e22e>parentPath</span>);
      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isWorkflow</span>(<span style=color:#a6e22e>parentElement</span>)) {
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Parent element is not a Workflow: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>parentPath</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
      }

      <span style=color:#75715e>// Directly modify the updatedModel object, by adding the new node to it
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>args</span>.<span style=color:#66d9ef>type</span>, <span style=color:#a6e22e>parentElement</span>, <span style=color:#a6e22e>args</span>);
      <span style=color:#a6e22e>updatedWorkflow</span>.<span style=color:#a6e22e>nodes</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>newNode</span>);

      <span style=color:#75715e>// Generate a patch using fast-json-patch.compare() and create a command
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>patch</span>: <span style=color:#66d9ef>Operation</span>[] <span style=color:#f92672>=</span> <span style=color:#a6e22e>compare</span>(<span style=color:#a6e22e>model</span>, <span style=color:#a6e22e>updatedModel</span>);
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PatchCommand</span>(<span style=color:#e6db74>&#39;Create Node&#39;</span>, <span style=color:#a6e22e>modelUri</span>, <span style=color:#a6e22e>patch</span>);

      <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>
      <span style=color:#75715e>// then get the command stack and execute the command as before
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>command</span>);

      <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>  }
}
</code></pre></div><p>The ModelManager framework also provides a convenience method to create a PatchCommand that will directly edit the JSON Model, using a Model Updater:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoffeeModelServiceImpl</span> <span style=color:#66d9ef>implements</span> <span style=color:#a6e22e>CoffeeModelService</span> {

  <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>
  <span style=color:#66d9ef>async</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>modelUri</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>parentPath</span>: <span style=color:#66d9ef>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>PatchResult</span>&gt; {
      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>getCoffeeModel</span>(<span style=color:#a6e22e>modelUri</span>);

      <span style=color:#75715e>// create a PatchCommand using a Model Updater. This allows us to directly
</span><span style=color:#75715e></span>      <span style=color:#75715e>// edit the model, without having to deal with JSON Patches at all.
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PatchCommand</span>(<span style=color:#e6db74>&#39;Create Node&#39;</span>, <span style=color:#a6e22e>modelUri</span>, <span style=color:#a6e22e>model</span> <span style=color:#f92672>=&gt;</span> {
        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>workflow</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getValueByPointer</span>(<span style=color:#a6e22e>model</span>, <span style=color:#a6e22e>parentPath</span>);
        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isWorkflow</span>(<span style=color:#a6e22e>parentElement</span>)) {
          <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>`Parent element is not a Workflow: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>parentPath</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
        }
        <span style=color:#75715e>// Directly modify the updatedModel object, by adding the new node to it.
</span><span style=color:#75715e></span>        <span style=color:#75715e>// Inside of the Model Updater, we are allowed to edit the model object
</span><span style=color:#75715e></span>        <span style=color:#75715e>// directly - no need to create our own working copy!
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>newNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createNode</span>(<span style=color:#a6e22e>args</span>.<span style=color:#66d9ef>type</span>, <span style=color:#a6e22e>parentElement</span>, <span style=color:#a6e22e>args</span>);
        <span style=color:#a6e22e>workflow</span>.<span style=color:#a6e22e>nodes</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>newNode</span>);
      });

      <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>
      <span style=color:#75715e>// then get the command stack and execute the command as usual
</span><span style=color:#75715e></span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>stack</span>.<span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>command</span>);

      <span style=color:#75715e>// [...]
</span><span style=color:#75715e></span>  }
}
</code></pre></div><h2 id=command-stack-ids>Command Stack IDs</h2><p>A Command can be executed on any CommandStack. The Command Stack ID defines how Undo/Redo will behave, especially when a Command affects multiple models. When undoing (or redoing) changes on a Command Stack, the latest command executed on this Stack will be undone, ignoring commands that were executed in different stacks.</p><p>The most typical use case is to have one command stack per editor, so editors are independent from each other: undoing changes in one editor (command stack) does not affect the state of other editors.</p><p>However, when models have cross-references, you may be able to open inter-related models in different editors. In this case, it can be necessary to use a shared command stack for all editors, to ensure all editors work on a consistent state of the model. In that case, you may want to use a Command Stack Identifier that represents the entire set of inter-related models, such as the parent folder path, or project name.</p><h2 id=model-hub-context>Model Hub Context</h2><p>A Context is a string identifier that defines the scope of a Model Hub. One model hub instance exists per context. Each Model Hub has its own set of Model Service Contributions, Model Manager, and set of Command Stacks, which are completely independent from other Model Hub instances. A Command executed in a given context cannot be undone from another context.</p><p>It is up to each application to decide how these contexts are defined. For example, you may decide that you need to isolate changes on a per-project basis, in which case it can be useful to use the Project ID as the Model Hub context. Alternatively, if you&rsquo;re defining several modeling languages without any relationship to each other, you may choose to use the language ID as the context.</p><p>For simpler applications, using a single, constant context ID is usually recommended.</p></div></article></div></div></div></section><section id=footer class=fragment><div class="container-fluid bg-light"><div class="container py-5"><div class=row><div class="col-md m-2 text-body"><h4></h4><a href=#><img src=/emfcloud/images/logo.png class="img-fluid w-50" alt="EMF Cloud"></a><div class="row justify-content-left ml-0"><span class="fa-stack fa-2x mt-3 mr-1" title=twitter><a href=https://twitter.com/emfcloud class=ignore-color-change><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-twitter fa-stack-1x fa-fw text-light"></i><span class=sr-only>twitter</span></a></span>
<span class="fa-stack fa-2x mt-3 mr-1" title=github><a href=https://github.com/eclipse-emfcloud/emfcloud class=ignore-color-change><i class="fas fa-circle fa-stack-2x"></i><i class="fab fa-github fa-stack-1x fa-fw text-light"></i><span class=sr-only>github</span></a></span>
<span class="fa-stack fa-2x mt-3 mr-1" title=github-discussions><a href=https://github.com/eclipse-emfcloud/emfcloud/discussions class=ignore-color-change><i class="fas fa-circle fa-stack-2x"></i><i class="far fa-comments fa-stack-1x fa-fw text-light"></i><span class=sr-only>github-discussions</span></a></span></div></div><div class="col-md m-2 text-body"><h4>Related Projects</h4><ul class="nav flex-column"><li class=nav-item><a class="nav-link p-0 display-5" href=https://eclipse.dev/glsp>Eclipse GLSP</a></li><li class=nav-item><a class="nav-link p-0 display-5" href=https://jsonforms.io>JSON Forms</a></li><li class=nav-item><a class="nav-link p-0 display-5" href=https://eclipsesource.com/technology/eclipse-theia>Eclipse Theia IDE</a></li><li class=nav-item><a class="nav-link p-0 display-5" href=https://eclipse.dev/che>Eclipse Che</a></li></ul></div><div class="col-md m-2 text-body"><div><h4 id=emf-cloud>EMF Cloud</h4><p>EMF Cloud is a project hosted at the <a href=https://eclipse.org>Eclipse Foundation</a>, lead by <a href=https://projects.eclipse.org/projects/ecd.emfcloud/who>Eugen, Philip and Maximilian</a>, organized within the <a href=https://projects.eclipse.org/projects/ecd>Eclipse Cloud Development</a> project.</p><p>Gefördert durch: <img src=/emfcloud/images/BMBF_Logo.svg alt="BMBG Logo"></p></div></div></div></div></div></section><footer class="overlay fragment container-fluid bg-secondary" id=copyright><div class=container><div class="row py-3"><div class=col-md><div class="row mx-0 my-2 justify-content-center text-center text-lg-none text-black-50"><div class="row mx-0 mr-lg-auto justify-content-center"><div class="col-auto px-1 copyright-legal">© Copyright&nbsp;2023</div><div class="col-auto px-0 copyright-by">by Eclipse Foundation</div></div></div></div><div class=col-md><div class="row mx-0 my-2 justify-content-center"><ul class="nav ml-lg-auto"><li class=nav-item><a class="nav-link py-0" href=https://projects.eclipse.org/projects/ecd.emfcloud>About</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/copyright.php>Copyright</a></li><li class=nav-item><a class="nav-link py-0" href=https://www.eclipse.org/legal/>Legal</a></li></ul></div></div></div></div></footer><div id=react></div><script async defer src=/emfcloud/scripts/syna-main.min.68ae1ae47948304c9c224cfc1a97ffe16c57514bc587dd6140dcb82389a8d299.js></script><script async defer src=/emfcloud/scripts/syna-content.min.bf537eb5ace369e45e8b4ed41b8d235a65db92236a400ed5659f7a3c41d0f221.js></script><script async defer src=/emfcloud/scripts/syna-collapse.min.1f6ca6206008af133f158e2b7b650b4156b8fc33189c5a6142db3bb43c7ad8e7.js></script></body></html>